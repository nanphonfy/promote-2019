#### 1 发展历史
>1926，第一台计算机：ENIAC，5000次/s加法运算。
- 冯诺依曼模型  
`输入设备->存储器（运算器、控制器）->输出设备`

>20世纪50~60年代，IMB主导大型机时代。  
20 世纪 80 年代（大型机霸主时代），计算机架构向2个方向发展：  
>>①CISC (Complex Instruction Set Computing，微处理器复杂指令集计算) CPU ->便宜， PC；  
②RISC (Reduced Instruction-Set Computer，精简指令集计算机) CPU ->昂贵，企业小型 UNIX 服务器。

- 发展里程碑
>大型主机有超强计算和 I/O 处理能力、稳定性、安全性等，随着计算机发展，缺点：  
①复杂性，培养运维人才成本很高；  
②贵，政府、金融、电信；  
③单点问题；  
④改用小型机、普通PC搭建系统架构。  

- 2009 Alibaba "去 IOE"
>IOE：IBM 小型机、Oracle 、EMC 高端存储。
130517最后一台 IBM小型机在支付宝下线。

- 为什么去 IOE?
>业务的不断发展，数据量和业务量呈爆发性增长，传统集中式Oracle数据库架构（所有数据都集中在
一个数据库，依靠大型高端设备提供高处理能力和扩展性）在扩展性方面遭遇瓶颈。
。

- 分布式系统意义
>①升级单机处理能力的性价比越来越低（CPU、内存、磁盘，垂直扩展，成本高）；  
②单机处理能力存在瓶颈；  
③很难达到稳定性和可用性。

### 分布式架构常见概念
- 集群
>饭店原来只有一个厨师，切菜洗菜备料炒菜全干。后来客人多了，又请了个厨师（他们的关系是集群），可炒一样的菜。

- 分布式
>为让厨师专心炒菜，请了配菜师切菜、备菜、备料，厨师和配菜师的关系是分布式。一个配菜师也忙不过来，又请了个配菜师，两配菜师关系是集群。

- 节点
>可独立按照分布式协议完成一组逻辑的程序个体。具体项目中，一个节点类比操作系统上的进程。

- 副本(replica/copy)
>①数据副本指在不同节点上持久化同一份数据，当某节点数据丢失时，可从副本读取数据。
是分布式系统中解决数据丢失的唯一手段；  
②服务副本指多节点提供相同服务，通过主从关系实现服务高可用。

- 中间件
>介于应用和系统之间，为开发者提供处理通信、输入输出的一类软件，让用户只关心自己的应用。

#### 架构发展过程
##### 阶段一：单应用架构
>网站初期，单机跑所有程序、软件，此时讲究效率。

##### 阶段二：应用和数据库服务器分离
>若代码层已无法优化，增加机器是比较好的——web和数据库服务器拆分，提高单机负载、容灾能力。

##### 阶段三：应用服务器集群
>通过应用服务器集群将请求分流到各个服务器中，提升负载。此时它们之间没直接交互，都依赖数据库各自对外提供服务。  
该阶段，各种问题慢慢呈现：①请求由谁转发；②若每次访问到的服务器不一样，如何维护session。

##### 阶段三：应用服务器集群
>通过应用服务器集群将请求分流到各个服务器中，提升负载。此时它们之间没直接交互，都依赖数据库各自对外提供服务。  
该阶段，各种问题慢慢呈现：①请求由谁转发；②若每次访问到的服务器不一样，如何维护session。

##### 阶段四：数据库读写分离
>阶段三提升了应用层性能，数据库负载慢慢增大。若单纯把数据库一分为二，会造成数据库不统一问题，故一般先考虑读写分离方式。  
该架构的问题：①主从库间的数据同步（可用mysql自带master-slave主从复制）；②对应数据源的选择 （第三方数据库中间件，eg.mycat）。

##### 阶段五：搜索引擎缓解读库压力
>数据库做读库，对模糊查找效率不好，电商网站中搜索非常核心，做了读写分离也不能有效解决瓶颈。此时需引入搜索引擎，大大提高查询速度。同时也带来些附加问题，eg.维护索引构建。

##### 阶段六：缓存缓解数据库压力
>逐渐出现多用户访问公共内容（热点数据），没必要每次都从数据库取，在应用层用缓存技术，eg.memcache、redis。  
另外， 若想对某些IP用户的访问频率做限制，放内存不合适，放数据库又太麻烦，此时可用Nosql，eg.mongDB。

##### 阶段七：数据库的水平/垂直拆分
>演进过程，交易、商品、用户数据都还在同一数据库，尽管增加缓存、读写分离，但随着数据库压力持续增加（单表过亿），数据库瓶颈仍是最大问题。
>- 垂直拆分：把不同业务数据拆分到不同的数据库；
>- 水平拆分：把同一表的数据拆分到两个或更多个数据库中。原因：某些业务数据量已达到单个数据库瓶颈，此时可将表拆分到多个数据库中。

##### 阶段八：应用拆分
>随着业务发展，应用压力越来越大，工程规模也越来越庞大，此时可考虑应用拆分。  
按领域模型将用户、商品、交易拆分成多个子系统，拆分后，可能有一些相同代码（eg.用户操作，商品和交易都需查询）， 会导致每个系统都会有用户查询访问相关操作（要抽象出来，是一个坑），通过走服务化路线。  
>>各服务间如何远程通信？
通过RPC技术，比较典型：webservice、hessian、http、RMI等。前期可很好地解决各服务间的通信问题，但互联网发展是持续的，故架构演变、优化持续ing...

##### 总结
层级 | 内容| 备注
---|---|---
应用服务层|web应用服务|---
服务治理|服务治理中间件|服务治理：dubbo、spring cloud
领域服务层|订单服务、商品服务...|rabbitmq/kafka、配置中心、定时调度中心
数据治理|数据库治理中间件|mycat/sharding-jdbc、链路调用监控、系统监控
数据服务层|DB|mysql、redis