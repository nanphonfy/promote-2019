#### 架构发展
- 电商架构
>早期单一应用架构，随互联网发展，通过垂直伸
缩很难达到期望，投入产出比很大，水平伸缩成为主流。  
分布式架构的服务越多、规模越大、机器越多时，人工管理和维护服务及配置地址信息会越来越难，单点问题：一旦服务路由或负载均衡服务器宕机，依赖它的所有服务均将失效。  
此时，需要一个能动态注册和获取服务信息的地方，统一管理服务名称和其对应的服务器列表信息，称为服务配置中心。  
服务提供者启动时，将提供的服务名称、服务器地址注册到服务配置中心，服务消费者通过服务配置中心获得需调用服务的机器列表。    
通过负载均衡算法，选其中一台调用。当服务器宕机或下线时，相应的机器需能动态从服务配置中心移除，并通知相应服务消费者，否则可能调用到已失效服务而发生错误，在此过程，消费者第一次调用时需查询服务配置中心，再缓存到本地，后续直接使用本地缓存的服务地址列表，直到有变更（机器上线或下线）。  
这种无中心化的结构解决了负载均衡设备导致的单点故障问题，大大减轻服务配置中心的压力。

#### zookeeper
>开源的分布式协调服务，雅虎创建，google chubby的开源实现。  
设计目标：将那些复杂且容易出错的分布式一致性服务封装起来，构成一个高效可靠的原语集（由若干条指令组成，完成一定功能的一个过程），提供简单易用的接口。

- 安装部署
>两种运行模式：集群和单机。
下载安装包：http://apache.fayea.com/zookeeper/

- 常用命令
```java 
1.启动服务:
bin/zkServer.sh start
2.查看服务状态:
bin/zkServer.sh status
3.停止服务:
bin/zkServer.sh stop
4.重启服务:
bin/zkServer.sh restart
5.连接服务器
zkCli.sh -timeout 0 -r -server ip:port
```
- 单机安装
>初次使用zookeeper，需将conf/zoo_sample.cfg复制一份重命名为zoo.cfg。  
修改dataDir（日志文件存放路径）目录。

- 集群安装
>集群中，各节点共有三种角色：leader、follower、observer。  
集群模式用3台机器搭建，分别复制、解压。

>- ①修改配置文件：修改端口  
server.1=IP1:2888:3888  
server.2=IP2.2888:3888  
server.3=IP3.2888:2888  
>>（2888：访问zookeeper的端口；3888：重新选举leader的端口）  
server.A=B：C：D  
>A：数字，第几号服务器；  
B：服务器ip地址；  
C：该服务器与集群中Leader交换信息的端口；  
D：若集群Leader挂了，需一个端口重新选举新Leader。该端口用来执行选举时服务器相互通信的端口。  
伪集群：B都一样，故不同Zookeeper实例通信端口号不能一样，需分配不同的端口号。  
集群模式，集群中每台机器都需感知到整个集群是
由哪几台机器组成，在配置文件中，按格式server.id=host:port:port，每一行代表一个机器配置。id:指的是serverID,用来标识该机器在集群中的机器序号。  
>- ②新建datadir目录：设置每台zookeeper的myid，都需在dataDir下创建一个myid文件，该文件只有一行内容，对应每台机器的Server ID，eg.server.1的myid为1。     确保每个服务器myid文件的数字不同， 且和所在机器的zoo.cfg中server.id的id值一致，范围是1~255。
>- ③启动zookeeper：Observer角色：在不影响写性能的情况下扩展zookeeper，本身zookeeper集群性能已很好，但若超大量客户端访问，必须增加数量，而随着服务器增加，zookeeper集群的写性能就会下降；  
zookeeper的znode变更需半数及以上服务器投票通过，而随着机器的增加，由于网络消耗等原因必导致投票成本增加，性能下降。