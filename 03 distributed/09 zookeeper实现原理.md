### zookeeper由来
>①各节点数据一致性；  
②怎么保证任务只在一个节点执行；  
③若其中一个节点挂了，其他节点如何发现并接替；  
④存在共享资源，互斥性、安全性。

>分布式系统的很多难题，都是由缺少协调机制造成。分布式协调做的较好的：Google Chubby、Apache Zookeeper。  
Google Chubby是一个分布式锁服务，解决分布式协作、Master选举等与分布式锁服务相关问题。  
Zookeeper也类似，在雅虎内部很多系统都需依赖一个系统来分布式协调，但谷歌的Chubby不开源，故雅虎基于Chubby的思想开发了zookeeper并捐赠给Apache。  
zookeeper架构，可用来解决task多实例执行问题，各服务先去zookeeper上注册节点，然后获得权限后再来访问task。

### zookeeper设计猜想
>主要解决分布式环境的服务协调问题，若实现一个zookeeper中间件需做啥？  
>- ①防单点故障：做集群，且集群若要满足高性能要求，还得是一个高性能、高可用集群。高性能意味该集群能够分担客户端的请求流量，高可用意味集群中某节点宕机后，不影响整个集群的数据和继续提供服务的可能性。    
结论：该中间件需考虑集群,且该集群还需分摊客户端的请求流量；  
>- ②要满足高性能，每个节点都能接到请求，且每个节点数据都必须保持一致。实现各节点数据一致性，要有一个 leader节点负责协调和数据同步操作。若集群无leader节点，每个节点都可接收所有请求，那该集群的数据同步复杂度很大。  
结论：该集群涉及数据同步，会存在leader节点；  
>- ③如何选举leader节点，leader挂了后，如何恢复？  
结论：zookeeper基于paxos理论衍生出ZAB协议；    
>- ④leader节点如何和其他节点保证数据一致性，且要求强一致。  
分布式系统中，每个节点虽都能知道自己的事务操作过程是成功/失败，却无法直接获取其他分布式节点的操作结果。故当一个事务操作涉及到跨节点时，就需用到分布式事务。  
分布式事务的数据一致性协议：2PC协议和3PC协议。

>基于如上猜想，基本知道zookeeper为何要用到zab理论做选举、为何要做集群、为何要用到分布式事务实现数据一致性。

#### 2PC提交